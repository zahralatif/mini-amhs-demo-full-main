(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{373:function(e,t,r){Promise.resolve().then(r.bind(r,9526))},9526:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var n=r(7437),o=r(2265),a=r(7651),s=r(6463),i=r(4358),l=r(8433),c=r(6727),d=r(511),u=r(468),h=r(1733),x=r(9806),m=r(3742),g=r(6548),p=r(6863),f=r(6907),b=r(4583),y=r(1655),j=r(428),v=r(1032);function S(){let{toggleColorMode:e}=(0,o.useContext)(f.k);return(0,n.jsx)(y.Z,{title:"Toggle theme",children:(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(j.Z,{fontSize:"small",sx:{opacity:.7}}),(0,n.jsx)(b.Z,{onChange:e,color:"primary"}),(0,n.jsx)(v.Z,{fontSize:"small",sx:{opacity:.7}})]})})}function Z(){let{username:e,logout:t}=(0,a.a)();return(0,n.jsx)(h.Z,{position:"sticky",color:"transparent",elevation:0,sx:{borderBottom:"1px solid #20202A",backdropFilter:"blur(6px)"},children:(0,n.jsxs)(x.Z,{sx:{display:"flex",gap:2,py:1.5},children:[(0,n.jsx)(p.Z,{sx:{mr:1,color:"primary.main"}}),(0,n.jsx)(d.Z,{variant:"h6",sx:{fontWeight:700},children:"Mini AMHS"}),(0,n.jsx)(m.Z,{label:"Demo",size:"small",sx:{ml:1,bgcolor:"primary.main",color:"primary.contrastText"}}),(0,n.jsx)(c.Z,{sx:{flexGrow:1}}),e&&(0,n.jsxs)(d.Z,{variant:"body2",sx:{mr:2},children:["Welcome, ",(0,n.jsx)("strong",{children:e})]}),(0,n.jsx)(S,{}),(0,n.jsx)(g.Z,{onClick:t,color:"inherit",children:"Logout"})]})})}var F=r(537),w=r(9343),k=r(1014),C=r(6264);function M(){let{token:e}=(0,a.a)();return{getJSON:(0,o.useCallback)(t=>(0,C.xA)(t,e||void 0),[e]),postJSON:(0,o.useCallback)((t,r)=>(0,C.ty)(t,r,e||void 0),[e])}}var I=r(4990),T=r(1252),z=r(3983),B=r(5774),A=r(3494),E=r(487);function P(e){let{message:t="Loading...",size:r=40,fullScreen:o=!1}=e,a=(0,n.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[(0,n.jsx)(u.Z,{size:r}),t&&(0,n.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:t})]});return o?(0,n.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:a}):a}function D(){return(0,n.jsxs)(c.Z,{sx:{p:3},children:[(0,n.jsx)(E.Z,{variant:"text",width:"30%",height:32,sx:{mb:2}}),Array.from({length:5}).map((e,t)=>(0,n.jsx)(c.Z,{sx:{mb:2},children:(0,n.jsx)(E.Z,{variant:"rectangular",height:60,sx:{borderRadius:1}})},t))]})}let W=F.Ry({receiver:F.Z_().min(2,"Receiver must be at least 2 characters").max(40,"Receiver must be less than 40 characters").regex(/^[a-zA-Z0-9_-]+$/,"Receiver can only contain letters, numbers, hyphens, and underscores"),subject:F.Z_().min(2,"Subject must be at least 2 characters").max(100,"Subject must be less than 100 characters"),body:F.Z_().min(1,"Message body is required").max(5e3,"Message body must be less than 5000 characters")});function _(e){var t,r,a;let{onSent:s}=e,{postJSON:i}=M(),[l,c]=(0,o.useState)(!1),[u,h]=(0,o.useState)({open:!1,message:"",severity:"success"}),{register:x,handleSubmit:m,formState:{errors:p},reset:f}=(0,w.cI)({resolver:(0,k.F)(W),defaultValues:{receiver:"",subject:"",body:""},mode:"onTouched"}),b=async e=>{c(!0);try{let t={receiver:e.receiver,subject:e.subject,body:e.body};await i("/api/messages",t),h({open:!0,message:"Message sent successfully! ✅",severity:"success"}),f(),null==s||s()}catch(e){h({open:!0,message:e.message||"Failed to send message. Please try again.",severity:"error"})}finally{c(!1)}};return(0,n.jsxs)(I.Z,{elevation:1,sx:{p:3},component:"form",onSubmit:m(b),role:"form","aria-label":"Send message form",children:[(0,n.jsx)(d.Z,{variant:"h6",sx:{mb:1.5,fontWeight:600},children:"Send Message"}),(0,n.jsxs)(T.Z,{spacing:2,children:[(0,n.jsx)(z.Z,{label:"Receiver",...x("receiver"),error:!!p.receiver,helperText:null===(t=p.receiver)||void 0===t?void 0:t.message,disabled:l,inputProps:{"aria-describedby":"receiver-helper-text"}}),(0,n.jsx)(z.Z,{label:"Subject",...x("subject"),error:!!p.subject,helperText:null===(r=p.subject)||void 0===r?void 0:r.message,disabled:l,inputProps:{"aria-describedby":"subject-helper-text"}}),(0,n.jsx)(z.Z,{label:"Message Body",...x("body"),error:!!p.body,helperText:null===(a=p.body)||void 0===a?void 0:a.message,multiline:!0,minRows:4,disabled:l,inputProps:{"aria-describedby":"body-helper-text"}}),(0,n.jsx)(g.Z,{type:"submit",variant:"contained",size:"large",disabled:l,"aria-label":l?"Sending message":"Send message",children:l?(0,n.jsx)(P,{message:"Sending...",size:20}):"Send Message"})]}),(0,n.jsx)(B.Z,{open:u.open,autoHideDuration:4e3,onClose:()=>h(e=>({...e,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,n.jsx)(A.Z,{onClose:()=>h(e=>({...e,open:!1})),severity:u.severity,sx:{width:"100%"},role:"alert",children:u.message})})]})}var O=r(7057);function R(e){let{refreshKey:t}=e,{getJSON:r}=M(),{username:s}=(0,a.a)(),[i,l]=(0,o.useState)([]),[c,u]=(0,o.useState)(0),[h,x]=(0,o.useState)(!1),[m,g]=(0,o.useState)({page:0,pageSize:10}),[p,f]=(0,o.useState)({open:!1,message:"",severity:"success"}),b=(0,o.useMemo)(()=>[{field:"id",headerName:"ID",width:80,headerAlign:"center",align:"center"},{field:"subject",headerName:"Subject",flex:1,minWidth:150,renderCell:e=>(0,n.jsx)(d.Z,{variant:"body2",sx:{fontWeight:400,color:"text.primary"},children:e.value})},{field:"sender",headerName:"From",width:140,renderCell:e=>(0,n.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:e.value})},{field:"created_at",headerName:"Time",width:200,valueFormatter:e=>{if(!e)return"";let t=new Date(e);return isNaN(t.getTime())?String(e):t.toLocaleString()},renderCell:e=>(0,n.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:e.formattedValue})}],[]);return((0,o.useEffect)(()=>{(async function(){x(!0),f(e=>({...e,open:!1}));let{page:e,pageSize:t}=m;try{let n="/api/messages?page=".concat(e+1,"&pageSize=").concat(t),o=await r(n);l(o.data),u(o.pagination.totalItems)}catch(e){f({open:!0,message:e.message||"Failed to load inbox",severity:"error"})}finally{x(!1)}})()},[t,m,r]),h&&0===i.length)?(0,n.jsxs)(I.Z,{elevation:1,sx:{p:3,height:"100%"},children:[(0,n.jsxs)(d.Z,{variant:"h6",sx:{mb:1.5,fontWeight:600},children:["Inbox for: ",(0,n.jsx)("strong",{children:s})]}),(0,n.jsx)(D,{})]}):(0,n.jsxs)(I.Z,{elevation:1,sx:{p:3,height:"100%"},role:"region","aria-label":"Message inbox",children:[(0,n.jsxs)(d.Z,{variant:"h6",sx:{mb:1.5,fontWeight:600},children:["Inbox for: ",(0,n.jsx)("strong",{children:s})]}),(0,n.jsxs)(d.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[c," message",1!==c?"s":""," total"]}),(0,n.jsx)("div",{style:{height:480,width:"100%"},children:(0,n.jsx)(O._,{rows:i,columns:b,disableRowSelectionOnClick:!0,pageSizeOptions:[5,10,25],paginationMode:"server",rowCount:c,paginationModel:m,onPaginationModelChange:g,loading:h,sx:{"& .MuiDataGrid-cell":{borderBottom:"1px solid",borderColor:"divider"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"background.paper",borderBottom:"2px solid",borderColor:"divider"}},"aria-label":"Messages data grid"})}),(0,n.jsx)(B.Z,{open:p.open,autoHideDuration:4e3,onClose:()=>f(e=>({...e,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,n.jsx)(A.Z,{onClose:()=>f(e=>({...e,open:!1})),severity:p.severity,sx:{width:"100%"},role:"alert",children:p.message})})]})}function N(){let{token:e,isLoading:t}=(0,a.a)(),r=(0,s.useRouter)(),[h,x]=(0,o.useState)(0);return((0,o.useEffect)(()=>{t||e||r.push("/auth")},[t,e,r]),t)?(0,n.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,n.jsx)(u.Z,{size:60})}):e?(0,n.jsxs)(c.Z,{children:[(0,n.jsx)(Z,{}),(0,n.jsxs)(i.Z,{maxWidth:"lg",sx:{py:4},children:[(0,n.jsx)(d.Z,{variant:"h4",sx:{fontWeight:700,mb:2},children:"Full‑Stack Messaging Demo"}),(0,n.jsx)(d.Z,{color:"text.secondary",sx:{mb:4},children:"Backend: Go + PostgreSQL \xb7 Frontend: Next.js + Material UI"}),(0,n.jsxs)(l.ZP,{container:!0,spacing:2,children:[(0,n.jsx)(l.ZP,{item:!0,xs:12,md:4,children:(0,n.jsx)(_,{onSent:()=>{x(e=>e+1)}})}),(0,n.jsx)(l.ZP,{item:!0,xs:12,md:8,children:(0,n.jsx)(R,{refreshKey:h})})]})]})]}):null}},6264:function(e,t,r){"use strict";r.d(t,{ty:function(){return a},xA:function(){return o}});let n="http://localhost:8080";async function o(e,t){let r=await fetch("".concat(n).concat(e),{method:"GET",headers:{"Content-Type":"application/json",...t?{Authorization:"Bearer ".concat(t)}:{}}});if(!r.ok)throw Error(await r.text()||"HTTP ".concat(r.status,": ").concat(r.statusText));return r.json()}async function a(e,t,r){let o=await fetch("".concat(n).concat(e),{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{}},body:JSON.stringify(t)});if(!o.ok)throw Error(await o.text()||"HTTP ".concat(o.status,": ").concat(o.statusText));return o.json()}},7651:function(e,t,r){"use strict";r.d(t,{H:function(){return i},a:function(){return l}});var n=r(7437),o=r(2265),a=r(6264);let s=(0,o.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,o.useState)(null),[l,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("jwt_token"),t=localStorage.getItem("username");e&&t&&(i(e),c(t))}catch(e){console.error("Error initializing auth:",e),localStorage.removeItem("jwt_token"),localStorage.removeItem("username")}finally{u(!1)}})()},[]);let h=async(e,t)=>{try{let r=await (0,a.ty)("/api/login",{username:e,password:t});if(!r.token)throw Error("Invalid response: No token received");i(r.token),c(e);try{localStorage.setItem("jwt_token",r.token),localStorage.setItem("username",e)}catch(e){console.warn("Failed to store auth data in localStorage:",e)}}catch(e){throw console.error("Login failed:",e),e}},x=async(e,t)=>{try{await (0,a.ty)("/api/register",{username:e,password:t}),await h(e,t)}catch(e){throw console.error("Registration failed:",e),e}};return(0,n.jsx)(s.Provider,{value:{token:r,username:l,register:x,login:h,logout:()=>{try{i(null),c(null),localStorage.removeItem("jwt_token"),localStorage.removeItem("username")}catch(e){console.error("Error during logout:",e),i(null),c(null)}},isLoading:d},children:t})}function l(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6907:function(e,t,r){"use strict";r.d(t,{k:function(){return c},Z:function(){return d}});var n=r(7437),o=r(2265),a=r(6395),s=r(124),i=r(4444),l=e=>{let t="dark"===e;return(0,i.Z)({palette:{mode:e,primary:{main:"#7C3AED",light:"#9F67FF",dark:"#5B21B6",contrastText:"#FFFFFF"},secondary:{main:"#10B981",light:"#34D399",dark:"#059669",contrastText:"#FFFFFF"},background:{default:t?"#0B0B0F":"#FAFAFA",paper:t?"#12121A":"#FFFFFF"},text:{primary:t?"#FFFFFF":"#111827",secondary:t?"#C7C7D1":"#4B5563"},brand:{main:"#7C3AED",light:"#9F67FF",dark:"#5B21B6",contrastText:"#FFFFFF"},error:{main:"#EF4444",light:"#F87171",dark:"#DC2626"},warning:{main:"#F59E0B",light:"#FBBF24",dark:"#D97706"},success:{main:"#10B981",light:"#34D399",dark:"#059669"}},shape:{borderRadius:16},typography:{fontFamily:"'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif",h1:{fontWeight:700,fontSize:"2.5rem"},h2:{fontWeight:600,fontSize:"2rem"},h3:{fontWeight:600,fontSize:"1.5rem"},h4:{fontWeight:600,fontSize:"1.25rem"},h5:{fontWeight:600,fontSize:"1.125rem"},h6:{fontWeight:600,fontSize:"1rem"}},components:{MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:14,fontWeight:500,padding:"8px 16px"}}},MuiPaper:{styleOverrides:{root:{borderRadius:18,backgroundImage:"none"}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:12}}}},MuiAppBar:{styleOverrides:{root:{backgroundImage:"none",boxShadow:"none"}}}}})};let c=o.createContext({toggleColorMode:()=>{},mode:"dark"});function d(e){let{children:t}=e,[r,i]=o.useState("dark");o.useEffect(()=>{let e=localStorage.getItem("theme-mode");e&&("light"===e||"dark"===e)&&i(e)},[]);let d=o.useMemo(()=>({toggleColorMode:()=>{i(e=>{let t="light"===e?"dark":"light";return localStorage.setItem("theme-mode",t),t})},mode:r}),[r]),u=o.useMemo(()=>l(r),[r]);return(0,n.jsx)(c.Provider,{value:d,children:(0,n.jsxs)(a.Z,{theme:u,children:[(0,n.jsx)(s.ZP,{}),t]})})}}},function(e){e.O(0,[257,167,199,577,433,274,971,23,744],function(){return e(e.s=373)}),_N_E=e.O()}]);