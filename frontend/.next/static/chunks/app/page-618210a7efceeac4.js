(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{373:function(e,t,s){Promise.resolve().then(s.bind(s,5059))},5059:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return z}});var r=s(7437),n=s(2265),a=s(7651),o=s(6463),i=s(4358),l=s(8433),c=s(6727),u=s(511),d=s(468),x=s(1733),m=s(9806),h=s(3742),g=s(6548),p=s(6863),f=s(9744),j=s(4583),v=s(1655),y=s(428),S=s(1032);function b(){let{toggleColorMode:e}=(0,n.useContext)(f.k);return(0,r.jsx)(v.Z,{title:"Toggle theme",children:(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(y.Z,{fontSize:"small",sx:{opacity:.7}}),(0,r.jsx)(j.Z,{onChange:e,color:"primary"}),(0,r.jsx)(S.Z,{fontSize:"small",sx:{opacity:.7}})]})})}function Z(){let{username:e,logout:t}=(0,a.a)();return(0,r.jsx)(x.Z,{position:"sticky",color:"transparent",elevation:0,sx:{borderBottom:"1px solid #20202A",backdropFilter:"blur(6px)"},children:(0,r.jsxs)(m.Z,{sx:{display:"flex",gap:2,py:1.5},children:[(0,r.jsx)(p.Z,{sx:{mr:1,color:"primary.main"}}),(0,r.jsx)(u.Z,{variant:"h6",sx:{fontWeight:700},children:"Mini AMHS"}),(0,r.jsx)(h.Z,{label:"Demo",size:"small",sx:{ml:1,bgcolor:"primary.main",color:"primary.contrastText"}}),(0,r.jsx)(c.Z,{sx:{flexGrow:1}}),e&&(0,r.jsxs)(u.Z,{variant:"body2",sx:{mr:2},children:["Welcome, ",(0,r.jsx)("strong",{children:e})]}),(0,r.jsx)(b,{}),(0,r.jsx)(g.Z,{onClick:t,color:"inherit",children:"Logout"})]})})}var w=s(537),k=s(9343),C=s(1014),F=s(6264);function M(){let{token:e}=(0,a.a)();return{getJSON:(0,n.useCallback)(t=>(0,F.getJSON)(t,e),[e]),postJSON:(0,n.useCallback)((t,s)=>(0,F.postJSON)(t,s,e),[e])}}var N=s(4990),I=s(1252),_=s(3983),P=s(5774),O=s(3494);let T=w.Ry({receiver:w.Z_().min(2,"Min 2 characters").max(40),subject:w.Z_().min(2,"Please add a subject").max(100),body:w.Z_().min(1,"Message body is required").max(5e3)});function D(e){var t,s,a;let{onSent:o}=e,{postJSON:i}=M(),[l,c]=(0,n.useState)(!1),[d,x]=(0,n.useState)({open:!1,message:"",severity:"success"}),{register:m,handleSubmit:h,formState:{errors:p},reset:f}=(0,k.cI)({resolver:(0,C.F)(T),defaultValues:{receiver:"",subject:"",body:""},mode:"onTouched"}),j=async e=>{c(!0);try{await i("/api/messages",e),x({open:!0,message:"Message sent ✅",severity:"success"}),f(),null==o||o()}catch(e){x({open:!0,message:e.message||"Failed to send",severity:"error"})}finally{c(!1)}};return(0,r.jsxs)(N.Z,{elevation:1,sx:{p:3},component:"form",onSubmit:h(j),children:[(0,r.jsx)(u.Z,{variant:"h6",sx:{mb:1.5,fontWeight:600},children:"Send Message"}),(0,r.jsxs)(I.Z,{spacing:2,children:[(0,r.jsx)(_.Z,{label:"Receiver",...m("receiver"),error:!!p.receiver,helperText:null===(t=p.receiver)||void 0===t?void 0:t.message}),(0,r.jsx)(_.Z,{label:"Subject",...m("subject"),error:!!p.subject,helperText:null===(s=p.subject)||void 0===s?void 0:s.message}),(0,r.jsx)(_.Z,{label:"Body",...m("body"),error:!!p.body,helperText:null===(a=p.body)||void 0===a?void 0:a.message,multiline:!0,minRows:4}),(0,r.jsx)(g.Z,{type:"submit",variant:"contained",size:"large",disabled:l,children:l?"Sending…":"Send"})]}),(0,r.jsx)(P.Z,{open:d.open,autoHideDuration:3e3,onClose:()=>x(e=>({...e,open:!1})),children:(0,r.jsx)(O.Z,{onClose:()=>x(e=>({...e,open:!1})),severity:d.severity,sx:{width:"100%"},children:d.message})})]})}var E=s(9783);function R(e){let{refreshKey:t}=e,{getJSON:s}=M(),{username:o}=(0,a.a)(),[i,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(0),[x,m]=(0,n.useState)(!1),[h,g]=(0,n.useState)({page:0,pageSize:10}),[p,f]=(0,n.useState)({open:!1,message:"",severity:"success"}),j=(0,n.useMemo)(()=>[{field:"id",headerName:"ID",width:80},{field:"subject",headerName:"Subject",flex:1,minWidth:150},{field:"sender",headerName:"From",width:140},{field:"created_at",headerName:"Time",width:200,valueFormatter:e=>{if(!e.value)return"";let t=new Date(e.value);return isNaN(t.getTime())?String(e.value):t.toLocaleString()}}],[]);return(0,n.useEffect)(()=>{(async function(){m(!0),f(e=>({...e,open:!1}));let{page:e,pageSize:t}=h;try{let r="/api/messages?page=".concat(e+1,"&pageSize=").concat(t),n=await s(r);l(n.data),d(n.pagination.totalItems)}catch(e){f({open:!0,message:e.message||"Failed to load inbox",severity:"error"})}finally{m(!1)}})()},[t,h,s]),(0,r.jsxs)(N.Z,{elevation:1,sx:{p:3,height:"100%"},children:[(0,r.jsxs)(u.Z,{variant:"h6",sx:{mb:1.5,fontWeight:600},children:["Inbox for: ",(0,r.jsx)("strong",{children:o})]}),(0,r.jsx)("div",{style:{height:480,width:"100%"},children:(0,r.jsx)(E._,{rows:i,columns:j,disableRowSelectionOnClick:!0,pageSizeOptions:[5,10,25],paginationMode:"server",rowCount:c,paginationModel:h,onPaginationModelChange:g,loading:x})}),(0,r.jsx)(P.Z,{open:p.open,autoHideDuration:3e3,onClose:()=>f(e=>({...e,open:!1})),children:(0,r.jsx)(O.Z,{onClose:()=>f(e=>({...e,open:!1})),severity:p.severity,sx:{width:"100%"},children:p.message})})]})}function z(){let{token:e,isLoading:t}=(0,a.a)(),s=(0,o.useRouter)(),[x,m]=(0,n.useState)(0);return((0,n.useEffect)(()=>{t||e||s.push("/login")},[t,e,s]),t||!e)?(0,r.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,r.jsx)(d.Z,{})}):(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(Z,{}),(0,r.jsxs)(i.Z,{maxWidth:"lg",sx:{py:4},children:[(0,r.jsx)(u.Z,{variant:"h4",sx:{fontWeight:700,mb:2},children:"Full‑Stack Messaging Demo"}),(0,r.jsx)(u.Z,{color:"text.secondary",sx:{mb:4},children:"Backend: Go + PostgreSQL \xb7 Frontend: Next.js + Material UI"}),(0,r.jsxs)(l.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(l.ZP,{item:!0,xs:12,md:4,children:(0,r.jsx)(D,{onSent:()=>{m(e=>e+1)}})}),(0,r.jsx)(l.ZP,{item:!0,xs:12,md:8,children:(0,r.jsx)(R,{refreshKey:x})})]})]})]})}},6264:function(e,t,s){},7651:function(e,t,s){"use strict";s.d(t,{H:function(){return i},a:function(){return l}});var r=s(7437),n=s(2265),a=s(6264);let o=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[s,i]=(0,n.useState)(null),[l,c]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("jwt_token");if(e){i(e);let t=localStorage.getItem("username");t&&c(t)}d(!1)},[]);let x=async(e,t)=>{try{let{token:s}=await (0,a.postJSON)("/api/auth/login",{username:e,password:t});i(s),c(e),localStorage.setItem("jwt_token",s),localStorage.setItem("username",e)}catch(e){throw console.error("Login failed:",e),e}},m=async(e,t)=>{try{await (0,a.postJSON)("/api/auth/register",{username:e,password:t}),await x(e,t)}catch(e){throw console.error("Registration failed:",e),e}};return(0,r.jsx)(o.Provider,{value:{token:s,username:l,register:m,login:x,logout:()=>{i(null),c(null),localStorage.removeItem("jwt_token"),localStorage.removeItem("username")},isLoading:u},children:t})}function l(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9744:function(e,t,s){"use strict";s.d(t,{Z:function(){return c},k:function(){return l}});var r=s(7437),n=s(2265),a=s(4444),o=s(6395),i=s(124);let l=n.createContext({toggleColorMode:()=>{}});function c(e){let{children:t}=e,[s,c]=n.useState("dark"),u=n.useMemo(()=>({toggleColorMode:()=>c(e=>"light"===e?"dark":"light")}),[]),d=n.useMemo(()=>(0,a.Z)({palette:{mode:s,primary:{main:"#7C3AED",contrastText:"#FFFFFF"},background:{default:"dark"===s?"#0B0B0F":"#fafafa",paper:"dark"===s?"#12121A":"#ffffff"},text:{primary:"dark"===s?"#FFFFFF":"#111827",secondary:"dark"===s?"#C7C7D1":"#4B5563"}},shape:{borderRadius:16},typography:{fontFamily:"'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"}}),[s]);return(0,r.jsx)(l.Provider,{value:u,children:(0,r.jsxs)(o.Z,{theme:d,children:[(0,r.jsx)(i.ZP,{}),t]})})}}},function(e){e.O(0,[705,672,906,971,23,744],function(){return e(e.s=373)}),_N_E=e.O()}]);